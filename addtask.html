<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
 <meta name="viewport" content="width=1200">
  <title>Add Task - TaskFlash</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
  <link rel="stylesheet" href="hcss.css">

  <style>
    .form-container {
      max-width: 600px;
      margin: 3rem auto;
      background: var(--surface, #fff);
      padding: 2rem;
      border-radius: 1rem;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .form-container h2 {
      text-align: center;
      color: var(--primary-dark);
      margin-bottom: 1.5rem;
    }

    .form-group {
      margin-bottom: 1rem;
    }

    .form-group label {
      display: block;
      margin-bottom: 0.5rem;
      color: var(--text-secondary);
      font-weight: 500;
    }

    .form-group input,
    .form-group select {
      width: 100%;
      padding: 0.7rem;
      border-radius: 0.5rem;
      border: 1px solid #ccc;
      background: #fff;
      color: #000;
    }

    .form-actions {
      text-align: center;
      margin-top: 1.5rem;
    }

    .form-actions button {
      padding: 0.8rem 1.5rem;
      font-size: 1rem;
    }

    .nav-links a {
      text-decoration: none;
      margin: 0 0.8rem;
      color: var(--text-primary);
      font-weight: 500;
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="supabaseClient.js"></script>
</head>

<body>

  <!-- Navbar -->
  <nav class="navbar">
    <div class="nav-content">
      <a href="index.html" class="logo">
        <i class="fas fa-tasks"></i> TaskFlash
      </a>
      <div class="nav-links">
        <a href="index.html">Home</a>
        <a href="tasks.html">My Tasks</a>
        <a href="profile.html">Profile</a>
        <a href="analytics.html">Analytics</a>
        <button type="button" class="btn btn-primary" onclick="logout()">Logout</button>

      </div>
    </div>
  </nav>

  <!-- Add Task Form -->
  <div class="form-container">
    <h2>Add New Task</h2>

    <div class="form-group">
      <label for="taskName">Task Name</label>
      <input type="text" id="taskName" placeholder="Enter task name" required>
    </div>

    <div class="form-group">
      <label for="taskUrgency">Urgency</label>
      <select id="taskUrgency">
        <option value="High">High</option>
        <option value="Medium" selected>Medium</option>
        <option value="Low">Low</option>
      </select>
    </div>

    <div class="form-group">
      <label for="taskDuration">Duration (minutes)</label>
      <input type="number" id="taskDuration" placeholder="Enter duration">
    </div>

    <div class="form-group">
      <label for="taskDatetime">Due Date & Time</label>
      <input type="datetime-local" id="taskDatetime">
    </div>

    <div class="form-actions">
      <button class="btn btn-primary" onclick="addTask()">Save Task</button>
    </div>
  </div>

  <script>
    let currentUser = null;

    document.addEventListener("DOMContentLoaded", async () => {
        const { data: { session } } = await supabase.auth.getSession();
        if (!session) {
            window.location.href = "login.html";
        } else {
            currentUser = session.user;
        }
    });

    // Corrected function for addtask.html
async function addTask() {
    if (!currentUser) {
        alert("You are not logged in.");
        return;
    }

    const name = document.getElementById("taskName").value;
    const urgency = document.getElementById("taskUrgency").value;
    const duration = document.getElementById("taskDuration").value;
    const datetimeValue = document.getElementById("taskDatetime").value; // Get the raw string value

    // --- FIX: Convert the local datetime string to a proper UTC ISO string ---
    const due_datetime_iso = datetimeValue ? new Date(datetimeValue).toISOString() : null;

    if (!name) {
        alert("Task name is required!");
        return;
    }
    
    const newTask = {
        user_id: currentUser.id,
        name: name,
        urgency: urgency,
        duration: duration ? parseInt(duration) : null,
        due_datetime: due_datetime_iso, // Use the corrected ISO string here
        completed: false
    };

    // --- SUPABASE INSERT ---
    const { error } = await supabase.from('tasks').insert(newTask);

    if (error) {
        alert("Error adding task: " + error.message);
    } else {
        alert("Task added successfully!");
        window.location.href = "tasks.html";
    }
}

    async function logout() {
        const { error } = await supabase.auth.signOut();
        if (error) { alert("Error logging out: " + error.message); }
        else {
            alert("Logged out successfully!");
            window.location.href = "login.html";
        }
    }
</script>
 
</body>

</html>